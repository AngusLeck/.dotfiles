#!/usr/bin/python

'''
Created on Aug 19, 2011
Version 1.0
This will allow you to record text snippets from the terminal
you identify the snippets by a name and then the content.

Add file support and file line numbers

@author: Michael Crosby crosbymichael.com
'''
import sys
import os

dataFile = os.getenv('HOME') + '/Dropbox/qiktxt.txt'

def main():
    checkForFile()
    parseFlags(sys.argv)

def parseFlags(args):
    for i in range(0, len(args)):
        if args[i] == '-l':
            listSnippets()
            break
        elif args[i] == '-n':
            n = i + 1
            findSnippet(args[n])
            break
        else:
            if i == 1:
                if len(args[i]) > 2:
                    n = i + 1
                    snippet = ''
                    for y in range(n, len(args)):
                        snippet = snippet + ' ' + args[y]
                    #end for
                    addSnippet(args[i], snippet)
                    break
                else:
                    print 'error'
            #end if
        #end parser
#end parseFlag

def addSnippet(name, data):
    if checkName(name):
        writeData(name, data)
    else:
        print name + ' is already in the file.'
#end addSnippet

def listSnippets():
    data = readData()
    for line in data:
        print 'Name: ' + line[0]
        print line[1]
#end listSnippets


def findSnippet(name):
    data = readData()
    for row in data:
        if row[0] == name:
            print row[1]
            break
        #endif
    #end for
#end findSnippet

def readData():
    global dataFile
    f = open(dataFile, 'rb')
    data = csvToArray(f.read())
    f.close()
    return data
#end readData

def writeData(name, data):
    global dataFile
    f = open(dataFile, 'a')
    f.write(name + ',' + data + '\n')
    f.close()
#end writeData

def checkName(name):
    data = readData()
    isOK = True
    for row in data:
        if row[0] == name:
            isOK = False
            break
        #end if
    #end for
    
    if isOK:
        return True
    else:
        return False
#end check name

def checkForFile():
    global dataFile
    if os.path.isfile(dataFile) == False:
        makeFile()
    else:
        return
#end check file

def makeFile():
    global dataFile
    f = open(dataFile, 'w')
    f.close()
#end makeFile
    
def csvToArray(data):
    rows = data.split('\n')
    arr = []
    for row in rows:
        if len(row) > 5:
            arr.append(row.split(','))
    return arr
#end csvToArray

if __name__ == '__main__':
    main()
